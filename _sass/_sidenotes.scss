/* Sidenotes - Tufte-style margin notes with proper layout */

// Import base variables
@use "base" as *;

/* Counter setup for automatic numbering */
article,
.content-sidenotes {
    counter-reset: sidenote-counter;
}

/* Hide the margin-toggle checkbox */
.margin-toggle {
    opacity: 0;
    position: absolute;
    pointer-events: none;
}

/* Sidenote number (reference in text) */
.sidenote-number {
    counter-increment: sidenote-counter;
    cursor: pointer;
    user-select: none;

    &::after {
        content: counter(sidenote-counter);
        font-size: 0.7rem;
        font-weight: 600;
        vertical-align: super;
        color: $accent-teal;
        margin-left: 0.15rem;
        position: relative;
        top: -0.3em;
    }

    // Keyboard accessibility
    &:focus {
        outline: 2px solid $accent-teal;
        outline-offset: 2px;
        border-radius: 2px;
    }
}

/* Sidenote content */
.sidenote {
    font-family: $font-body;
    font-size: 0.85rem;
    line-height: 1.4;
    color: lighten($text-dark, 20%);

    &::before {
        content: counter(sidenote-counter) ". ";
        font-weight: 600;
        color: $accent-teal;
    }
}

/* DESKTOP LAYOUT (>768px): Sidenotes in right margin */
@media (min-width: calc($mobile + 1px)) {

    /* Main content container with sidenote margin */
    .content-sidenotes {
        position: relative;
        max-width: $content-width;

        // Reserve space for sidenotes in right margin
        margin-right: calc(#{$sidenote-width} + 5%);
    }

    /* Position sidenotes in the right margin */
    .sidenote {
        position: absolute;
        right: calc(-#{$sidenote-width} - 5%);
        width: $sidenote-width;
        margin-top: 0;
        padding-left: 1.5rem;

        // Optional: subtle left border
        border-left: 1px solid lighten($border-light, 5%);
    }

    /* Ensure sidenotes align with their reference point */
    .sidenote-number {
        position: relative;
    }

    /* Label behavior on desktop - clicking does nothing, always visible */
    .margin-toggle:checked+.sidenote,
    .sidenote {
        display: block;
    }
}

/* MOBILE LAYOUT (â‰¤768px): Sidenotes inline */
@media (max-width: $mobile) {

    /* Content expands to full width */
    .content-sidenotes {
        max-width: 90%;
        margin: 0 auto;
    }

    /* Hide sidenotes by default on mobile */
    .sidenote {
        display: none;
        margin-top: $spacing-xs;
        margin-bottom: $spacing-sm;
        padding: $spacing-sm;
        background-color: lighten($code-bg, 2%);
        border-left: 3px solid $accent-teal;
        border-radius: 4px;
    }

    /* Show sidenote when checkbox is checked */
    .margin-toggle:checked+.sidenote {
        display: block;
    }

    /* Make the sidenote number visually interactive */
    .sidenote-number {
        &::after {
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        &:hover::after {
            background-color: lighten($accent-teal, 50%);
            padding: 0 0.2em;
            border-radius: 2px;
        }
    }
}

/* TABLET ADJUSTMENTS (768px-1023px) */
@media (min-width: calc($mobile + 1px)) and (max-width: $tablet) {
    .content-sidenotes {
        max-width: 60%;
    }

    .sidenote {
        right: calc(-35% - 2%);
        width: 30%;
        padding-left: 1rem;
        font-size: 0.8rem;
    }
}

/* Full-width layout: No sidenotes in margin */
.content-full-width {
    max-width: 90%;
    margin: 0 auto;

    .sidenote {
        display: block;
        float: none;
        position: static;
        width: 100%;
        margin: $spacing-sm 0;
        padding: $spacing-sm;
        background-color: lighten($code-bg, 2%);
        border-left: 3px solid $accent-teal;
        border-radius: 4px;
    }

    .margin-toggle {
        display: none;
    }
}

/* Print styles: Sidenotes inline for archival */
@media print {
    .sidenote {
        display: block;
        position: static;
        float: none;
        width: 100%;
        margin: $spacing-sm 0;
        padding: 0.5rem 1rem;
        background-color: #f9f9f9;
        border-left: 2px solid #000;
        page-break-inside: avoid;
    }

    .margin-toggle {
        display: none;
    }

    .sidenote-number::after {
        color: #000;
    }
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
    body.dark-mode {
        .sidenote-number::after {
            color: $accent-teal-dark;
        }

        .sidenote {
            color: darken($text-light, 20%);
            border-left-color: lighten($border-dark, 10%);

            &::before {
                color: $accent-teal-dark;
            }
        }

        @media (max-width: $mobile) {
            .sidenote {
                background-color: lighten($code-bg-dark, 5%);
                border-left-color: $accent-teal-dark;
            }
        }

        .content-full-width .sidenote {
            background-color: lighten($code-bg-dark, 5%);
            border-left-color: $accent-teal-dark;
        }
    }
}